<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutton Racer: Workshop Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Press+Start+2P&display=swap');

        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
        }
        .back-btn {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 50;
            padding: 10px 14px;
            border-radius: 12px;
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(56,189,248,0.5);
            color: #38bdf8;
            font-weight: 800;
            text-decoration: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .back-btn:hover {
            background: rgba(56,189,248,0.12);
            color: #e2e8f0;
        }

        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }

        .console-input {
            background: transparent;
            border: none;
            outline: none;
            color: #4ade80;
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
        }

        .CRT {
            position: relative;
        }
        .CRT::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 10;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* Animations */
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .msg-enter {
            animation: slideIn 0.3s ease-out forwards;
        }

        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none; 
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col md:flex-row">
    <a class="back-btn" href="/index.html">‚Üê Exit</a>

    <!-- Sidebar: The IDE / Guide -->
    <div id="sidebar" class="w-full md:w-1/3 h-1/3 md:h-full bg-slate-900 border-r border-slate-700 flex flex-col shadow-2xl z-20">
        <!-- Header -->
        <div class="p-4 border-b border-slate-700 bg-slate-800 flex justify-between items-center sidebar-header">
            <!-- Restored Title on Left -->
            <h1 class="text-xl font-bold text-blue-400 pixel-font tracking-tighter">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUTTON RACER</h1>

            <!-- Right side container for Indicator and Logo -->
            <div class="flex items-center gap-4">
                <!-- Logo Container Moved to Right -->
                <div class="h-10 w-auto">
                    <svg class="h-full w-auto" xmlns="http://www.w3.org/2000/svg" id="ae2fc44a-886d-4a1c-b940-625451ea6494" data-name="Layer 1" viewBox="0 0 361.72 125.94"><path d="M144.46,230.25" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M141.68,236.3" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M145.16,230.65" transform="translate(-68.98 -174.01)" fill="none" stroke="#fff" stroke-miterlimit="3.86" stroke-width="0.48"></path><path d="M167.71,224.41c-1.28-.45-3.14-1.14-5.53-2.11l-1.8-.74c-2.34,1.59-4.8,3.16-7.33,4.68,2.48,1.27,5,2.48,7.39,3.51C162.93,228.05,165.37,226.25,167.71,224.41Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M164.92,206.65l.41.17,1.75.7c-.12-1.69-.23-3.44-.34-5.11-1.35,1-2.92,2.19-4.33,3.2Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M155.52,210.06c1.85.88,3.72,1.73,5.57,2.51,1.87-1.3,4-2.9,5.83-4.28l-1.88-.76-.41-.17c-1-.41-2-.83-3-1.27C159.64,207.43,157.6,208.77,155.52,210.06Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M160.33,220.77c2.31-1.61,4.58-3.29,6.77-5-1.17-.45-2.68-1-4.11-1.62l-1.84-.76c-2.27,1.54-4.65,3.07-7.09,4.55C156.13,218.93,158.24,219.88,160.33,220.77Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M150.27,233c.86.45,1.76.91,2.67,1.36,2.28-1.35,4.51-2.75,6.64-4.17-2.36-1.05-4.87-2.26-7.31-3.52-1.93,1.14-4.07,2.38-6.66,3.73C147.14,231.33,148.7,232.2,150.27,233Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M152.24,204.84l-2.11,1.2-1.18.66,1.42.76c1.41.74,2.87,1.47,4.36,2.18,2.05-1.26,4.05-2.56,6-3.87-1.83-.81-3.75-1.71-5.6-2.62C154.15,203.72,153.19,204.29,152.24,204.84Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M149.55,215.64c1.21.63,2.46,1.25,3.71,1.86,2.4-1.44,4.75-2.94,7-4.45-1.79-.77-3.59-1.59-5.37-2.44-2.34,1.44-4.73,2.81-7.09,4.06Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M151.53,235.22l.6-.35-2.22-1.16c-1.58-.83-3.19-1.71-4.77-2.63-.19,3.26-.32,6-.37,6.95l.82.46C147,237.78,149,236.66,151.53,235.22Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M169,233.12c-.15-2.45-.34-5.43-.55-8.29-2.28,1.81-4.66,3.57-7.09,5.25.91.39,1.84.77,2.77,1.15C166.13,232.05,168,232.74,169,233.12Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M148.15,206.25l1.64-.9c1.36-.78,2.82-1.63,4.48-2.61-.88-.45-1.76-.9-2.62-1.36s-2.72-1.47-3.29-1.78l-.93.5c-.11,1.73-.24,3.61-.38,5.48Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><polygon points="75.82 64.92 75.83 64.92 75.82 64.91 75.82 64.92" fill="#ffcd00"></polygon><path d="M147.48,199.2l.23-.13-.21-.13Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M152.24,225.82c2.49-1.48,4.92-3,7.24-4.58-2-.87-4.07-1.8-6.08-2.78-2.44,1.45-4.87,2.8-7.24,4,1.65,1,3.34,1.91,5,2.81h0Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M166.63,200.67c-.11-1.81-.19-3.46-.25-4.78v-.2c-1.31,1-2.82,2-4.32,3.06Q164.93,200,166.63,200.67Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M147.66,195.89c0,.65-.07,1.39-.11,2.19l.95.56c1.91-1,3.82-2.16,5.69-3.29l.18-.11.19.09c2.15,1.06,4.38,2.09,6.64,3.08,1.81-1.25,3.66-2.54,5.17-3.68.07-4.64,1.62-8.2-.54-13.57-1.28-3.19,1.1,6.49-1.78,13.5l-1.8-1.1a23.9,23.9,0,0,0-.69-16.23s-.68-1.26-.41,1.5.55,11.45-1.23,14.73h-1.64S159.65,179.1,157,174c-2.63,5.09-1.26,19.55-1.26,19.55h-1.64c-1.78-3.28-1.51-12-1.23-14.73s-.42-1.5-.42-1.5a23.93,23.93,0,0,0-.68,16.23l-1.81,1.1c-2.87-7-.5-16.69-1.78-13.5C145.88,187,147.87,190.65,147.66,195.89Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M167.71,216.25c-2.1,1.66-4.27,3.28-6.48,4.83l1.24.51c2.62,1.06,4.61,1.79,5.88,2.22-.18-2.32-.36-4.5-.54-6.16C167.81,217.65,167.77,217.13,167.71,216.25Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M169,234.09V234c-.92-.33-2.94-1.08-5.21-2-1.12-.45-2.24-.92-3.33-1.39-2.17,1.45-4.43,2.88-6.74,4.26,2.9,1.43,5.91,2.8,8.77,4C164.66,237.31,167.08,235.58,169,234.09Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M150.71,226.72l.75-.43-.63-.33h0c-1.64-.86-3.34-1.8-5.19-2.89-.16,2.18-.3,4.51-.43,6.69C147,228.82,148.85,227.8,150.71,226.72Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M148,239.82c2.64,1.38,5,2.53,7.19,3.53,2.25-1.32,4.44-2.68,6.53-4.06-2.87-1.19-5.89-2.56-8.77-4-2.31,1.35-4.41,2.53-6.55,3.64l.06,0Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M160.65,246.48l-.75-.3c-1.44-.58-3.07-1.24-4.66-2l-.55.32c-1.64.95-3.3,1.84-4.87,2.68a17.67,17.67,0,0,0,7.2,2.49,17.93,17.93,0,0,0,6.55-2.09C162.68,247.28,161.52,246.84,160.65,246.48Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M163.42,239.08c1.85.75,3.67,1.44,5.44,2.08a12.19,12.19,0,0,0,.42-2.75s-.07-1.34-.19-3.39C167.35,236.33,165.31,237.79,163.42,239.08Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M162.63,239.63c-1.94,1.3-4.15,2.69-6.57,4.12,1.41.62,2.84,1.2,4.13,1.72l.75.3c1.05.43,2.55,1,3.45,1.35a10.49,10.49,0,0,0,4.23-5.23C166.79,241.26,164.78,240.5,162.63,239.63Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M154.3,243.88l.08,0c-2.25-1.05-4.51-2.17-6.71-3.34l-1.81-1-.25-.14-.72.37a10.3,10.3,0,0,0,4.22,7C150.78,245.85,152.56,244.89,154.3,243.88Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M155.87,202.67c1.88.92,3.82,1.82,5.65,2.62,1.65-1.16,3.57-2.58,5.13-3.78-1.27-.51-3.1-1.28-5.44-2.29C159.49,200.39,157.7,201.54,155.87,202.67Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M151.2,218.72l1.24-.73c-1.08-.54-2.17-1.11-3.24-1.67-.75-.39-1.5-.8-2.25-1.21l-.67.36c-.11,1.29-.18,2.08-.18,2.08-.12,1.19-.24,2.63-.36,4.19C147.41,220.86,149.38,219.77,151.2,218.72Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M149.18,199.15c.93.53,1.88,1,2.83,1.55s2,1,3.07,1.55c1.8-1.1,3.57-2.23,5.27-3.37-2-.89-4-1.82-5.94-2.77C152.69,197.16,150.93,198.18,149.18,199.15Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M162,212.89l1.29.53c1.53.62,3.15,1.26,4.34,1.71-.11-1.56-.27-3.72-.43-6.07C165.58,210.3,163.68,211.69,162,212.89Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M147.38,206.72h0l0,0-.41-.25c0,.18,0,.35,0,.53Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M146.4,214.4c1.26-.67,3.17-1.7,4.64-2.55,1-.55,1.92-1.13,2.88-1.71-1.31-.64-2.62-1.31-3.91-2l-.56-.29-1.31-.68-1.26.72c-.19,2.47-.37,4.78-.52,6.53Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><rect x="86.65" y="74.79" width="2.61" height="38.57" fill="#ffcd00"></rect><path d="M157.05,300S146,251.44,111.67,210.22c0,0,22.39,15.68,45.38,65Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M157.05,299.92s11.07-48.52,45.37-89.74c0,0-22.38,15.69-45.37,65.06Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M101.76,246.06" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M101.89,251.76" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M102.45,246.1" transform="translate(-68.98 -174.01)" fill="none" stroke="#fff" stroke-miterlimit="3.86" stroke-width="0.48"></path><path d="M114.78,239.53l2.47-.15c1.86-.13,3.51-.28,4.44-.37-1-1.8-2.27-4-3.48-6.07C117.15,235.15,116,237.36,114.78,239.53Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M106.47,240.45c-1,1.57-2.2,3.3-3.65,5.27,1.48.11,3,.19,4.46.24.82,0,1.68,0,2.54,0,1.22-1.86,2.39-3.74,3.48-5.6C111.12,240.49,108.78,240.5,106.47,240.45Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M110.79,233.44c-1.19,2.07-2.47,4.17-3.82,6.25,2.34,0,4.7,0,6.88-.07,1.25-2.21,2.43-4.47,3.53-6.73-1.16.13-2.81.3-5,.45Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M122.09,239.74c-.83.08-2.68.26-4.79.41-1,.07-2.06.13-3.06.17-1.1,1.9-2.28,3.81-3.52,5.71,2.73,0,5.52-.07,8.11-.24C119.94,243.85,121.15,241.61,122.09,239.74Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M110,226.74l-1.68.1c-1.14,2-2.38,4-3.68,6.06,1.93,0,3.87-.06,5.77-.16,1.15-2.06,2.25-4.18,3.26-6.29C112.6,226.54,111.26,226.65,110,226.74Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M110.72,220.77l-1.65.12-.37,0c-.93.07-1.87.12-2.8.16-1,1.73-2,3.48-3.11,5.22,1.71,0,3.43-.06,5.1-.15C108.82,224.47,109.87,222.47,110.72,220.77Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M105.56,240.43l-.51,0h0c-1.58,0-3.23-.13-5.06-.27.69,1.7,1.43,3.51,2.14,5.2,1-1.39,2.05-2.86,3.07-4.38Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M109,247.2l.28-.42-2-.05c-1.53,0-3.09-.12-4.65-.23l2.29,5.38.8,0C106.48,250.86,107.66,249.23,109,247.2Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M111.33,221.26c-.75,1.52-1.66,3.25-2.5,4.78l1.1-.07c1.39-.1,2.87-.21,4-.31C113.22,224.52,112.32,223,111.33,221.26Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M124.75,246c-1.64.2-3.47.37-5.44.51-1,1.7-2.14,3.56-3.44,5.53,1.29-.06,2.57-.14,3.72-.23l.69,0c1-.07,2.35-.19,3.2-.27A9,9,0,0,0,124.75,246Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M107.69,214.9c-.75-1.33-1.43-2.56-2-3.54l0-.09c-.62,1.2-1.36,2.54-2.11,3.86C105.29,215.05,106.66,215,107.69,214.9Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M101.39,227.07c-1.22,0-2.45,0-3.66-.07h-.54L96,227l-.71,1c.77,1.92,1.48,3.72,2,5.1.72-1,1.8-2.5,2.62-3.7C100.37,228.63,100.88,227.86,101.39,227.07Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M92.39,221l.06-.08h-.09Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M98.25,223.59c-.4.6-.81,1.19-1.21,1.76-.19.29-.38.56-.57.83l1.28,0c1.35,0,2.74.05,4.15.05,1.07-1.71,2.1-3.42,3.07-5.12-1.68.07-3.45.1-5.18.09C99.29,222,98.77,222.82,98.25,223.59Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M106.42,220.28l2.22-.14.38,0,1.59-.11c-.71-1.23-1.43-2.49-2.12-3.71C107.86,217.57,107.11,219,106.42,220.28Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M111.33,232.64l1-.07c2.41-.17,4.2-.35,5.34-.49-1-1.71-1.95-3.29-2.7-4.5l-.57-1C113.47,228.62,112.42,230.65,111.33,232.64Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M114.94,252.05c1.2-1.82,2.35-3.66,3.43-5.46-2.62.16-5.41.23-8.14.21-1.23,1.86-2.39,3.52-3.59,5.16l1.46.07C110.64,252.1,112.88,252.11,114.94,252.05Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M119.78,245.68c1.66-.12,3.3-.27,4.86-.44a9.93,9.93,0,0,0-.7-2.22s-.54-1-1.39-2.48C121.72,242.16,120.73,244,119.78,245.68Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M102.57,234.61c.21-.3.42-.62.63-.94-1,0-2,0-3-.07L98,233.52l-.38.53.63,1.61c.34,1,.78,2.08,1.26,3.3C100.47,237.67,101.57,236.1,102.57,234.61Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M120.33,252.53l-.68.05c-1.33.09-2.82.2-4.31.25l-.28.43c-1,1.46-2.06,2.95-2.73,3.87a15.13,15.13,0,0,0,6.42-.8,15.32,15.32,0,0,0,4.22-4C122.14,252.39,121.11,252.48,120.33,252.53Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M114.4,252.85c-2.09,0-4.22,0-6.32,0l-1.75-.07h-.23l-.41.54a8.82,8.82,0,0,0,5.78,3.74C112.1,256.15,113.31,254.48,114.4,252.85Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M93,220.14c1.06-1.52,2.11-3.08,3.12-4.65l.12-.18h.21c2,0,4.13,0,6.23-.12.93-1.64,1.87-3.34,2.61-4.78-1.67-3.58-1.83-6.88-5.49-10.19-2.18-2,3.28,4.59,3.7,11.07l-1.8-.17A20.49,20.49,0,0,0,95,198.88s-1-.72.25,1.31S100,208.8,99.88,212l-1.27.61S94.23,201,90.3,198c-.11,4.91,6.38,15.53,6.38,15.53l-1.27.61c-2.6-1.86-5.65-8.64-6.48-10.88s-.89-1-.89-1a20.54,20.54,0,0,0,5.58,12.76l-1,1.52c-4.85-4.32-6.66-12.66-6.44-9.73.38,5.35,3.3,7.44,5.11,11.55.22.5.46,1.06.71,1.67Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M93.81,220.29c.88.05,1.77.09,2.66.12s1.92,0,2.91,0c1-1.49,1.87-3,2.73-4.47-1.85.08-3.69.11-5.48.1C95.71,217.5,94.77,218.91,93.81,220.29Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M100.28,220.48c1.75,0,3.53,0,5.21-.11.81-1.48,1.73-3.24,2.47-4.72-1.17.08-2.79.17-4.93.27C102.17,217.43,101.24,219,100.28,220.48Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M92.74,221.78c.55,1.34,1.14,2.79,1.72,4.25l1.1.1.9-1.28c.74-1.09,1.52-2.26,2.41-3.61l-2.43-.06L93.27,221Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M105.07,239.64l1,0c1.34-2,2.61-4.09,3.78-6.13-1.84.09-3.74.12-5.59.13-1.31,2-2.66,3.92-4,5.7C101.84,239.5,103.46,239.59,105.07,239.64Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M95.07,226.89h0l0,0-.29,0,.12.3Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M103.72,232.88c1.28-2,2.5-4,3.63-5.94-1.62.08-3.27.12-4.92.13-1.25,2-2.54,3.87-3.86,5.69l1.62.07C101.35,232.87,102.54,232.88,103.72,232.88Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><rect x="124.47" y="253.98" width="2.24" height="33.05" transform="translate(-174.84 -91.59) rotate(-26)" fill="#ffcd00"></rect><path d="M137.65,295S110.88,261.81,69,242.94c0,0,23.13,3.68,59.39,33.07Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M137.63,295s-9.7-41.53,1.23-86.16c0,0-11.35,20.49-10.5,67.15Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M212.31,246.1" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M212.18,251.8" transform="translate(-68.98 -174.01)" fill="none" stroke="#231f20" stroke-miterlimit="3.86" stroke-width="0.77" fill-rule="evenodd"></path><path d="M211.62,246.14" transform="translate(-68.98 -174.01)" fill="none" stroke="#fff" stroke-miterlimit="3.86" stroke-width="0.48"></path><path d="M196.69,232.93c1.1,2.26,2.28,4.52,3.53,6.73,2.18.09,4.54.11,6.88.07-1.35-2.08-2.64-4.18-3.82-6.25l-1.63-.1C199.5,233.23,197.84,233.06,196.69,232.93Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M204.14,226l1.1.07c-.84-1.53-1.75-3.26-2.5-4.78l-2.56,4.4C201.27,225.8,202.74,225.91,204.14,226Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M209.45,232.94c-1.3-2-2.54-4.06-3.68-6.06l-1.68-.1c-1.28-.09-2.62-.2-3.67-.29,1,2.11,2.11,4.22,3.26,6.29C205.58,232.88,207.52,232.94,209.45,232.94Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M206,252.07l1.46-.07c-1.2-1.64-2.36-3.29-3.6-5.16-2.72,0-5.51-.05-8.13-.21,1.08,1.81,2.23,3.64,3.43,5.46C201.19,252.15,203.43,252.14,206,252.07Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M203.35,246.07c-1.24-1.9-2.42-3.82-3.52-5.71-1,0-2-.1-3.06-.17-2.11-.15-4-.33-4.79-.41.94,1.87,2.15,4.11,3.26,6.05C197.83,246,200.62,246.08,203.35,246.07Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M192.38,239c.93.1,2.58.25,4.44.38l2.46.15c-1.21-2.17-2.36-4.38-3.42-6.59C194.65,235.06,193.4,237.24,192.38,239Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M216.32,226.27l1.28-.05-.57-.82c-.4-.58-.81-1.17-1.21-1.77-.52-.78-1-1.57-1.54-2.34-1.73,0-3.5,0-5.18-.09,1,1.7,2,3.41,3.07,5.11C213.57,226.32,215,226.31,216.32,226.27Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M209,240.45h0l-.51,0,.36.53c1,1.52,2,3,3.07,4.38.71-1.69,1.45-3.5,2.14-5.2C212.25,240.32,210.59,240.41,209,240.45Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M206.81,246.77l-2,0,.28.42c1.09,1.62,2.23,3.25,3.32,4.72l.8-.05c.34-.79,1.23-2.87,2.28-5.38C209.9,246.65,208.33,246.73,206.81,246.77Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M218.12,227l-1.24,0h-.54c-1.22,0-2.44.07-3.66.07.5.78,1,1.56,1.52,2.32.81,1.2,1.9,2.7,2.62,3.7.53-1.38,1.24-3.18,2-5.1Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M203.46,220l1.59.12.38,0,2.22.14c-.69-1.28-1.44-2.71-2.07-4C204.89,217.56,204.16,218.82,203.46,220Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M205.37,221l-.37,0-1.65-.12c.85,1.7,1.9,3.7,2.83,5.37,1.67.09,3.39.14,5.1.15-1.1-1.74-2.14-3.49-3.11-5.22C207.24,221.07,206.3,221,205.37,221Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M209.8,233.71c-1.86,0-3.73,0-5.58-.13,1.18,2,2.45,4.09,3.79,6.13l1,0c1.61-.05,3.23-.14,4.82-.27-1.35-1.78-2.69-3.7-4-5.7Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M200.77,240.45c1.09,1.86,2.26,3.74,3.48,5.59.86,0,1.71,0,2.54,0,1.48-.05,3-.13,4.46-.24-1.45-2-2.61-3.7-3.65-5.27C205.29,240.54,203,240.53,200.77,240.45Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M199,253.3l-.29-.43c-1.48-.05-3-.16-4.3-.25l-.68-.05c-.78,0-1.81-.14-2.64-.21a15.32,15.32,0,0,0,4.22,4,15.13,15.13,0,0,0,6.42.8C201.07,256.25,200,254.75,199,253.3Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M193.79,251.81l.68,0c1.16.08,2.44.17,3.73.23-1.3-2-2.45-3.83-3.44-5.53-2-.14-3.8-.31-5.44-.51a9.09,9.09,0,0,0,1.26,5.5C191.46,251.62,192.82,251.74,193.79,251.81Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M208,252.75l-.23,0-1.75.07c-2.1.07-4.23.09-6.33,0,1.1,1.62,2.31,3.29,2.93,4.15a8.86,8.86,0,0,0,5.79-3.74Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M216.06,233.56l-2.16.08c-1,0-2,.06-3,.07.21.32.42.64.63.94,1,1.49,2.1,3,3.05,4.35.48-1.22.92-2.35,1.26-3.3l.63-1.61Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M194.29,245.71c-.95-1.66-1.94-3.51-2.77-5.14-.85,1.5-1.39,2.49-1.39,2.49a9.93,9.93,0,0,0-.7,2.22C191,245.45,192.63,245.6,194.29,245.71Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M221.43,216.61l-1-1.52A20.49,20.49,0,0,0,226,202.33s-.05-1.23-.88,1-3.88,9-6.48,10.88l-1.27-.61s6.49-10.62,6.38-15.53c-3.93,2.93-8.31,14.58-8.31,14.58l-1.27-.61c-.14-3.2,3.34-9.79,4.59-11.81s.25-1.32.25-1.32a20.51,20.51,0,0,0-6.63,12.25l-1.81.17c.42-6.48,5.89-13,3.71-11.07-3.66,3.31-3.82,6.61-5.49,10.19.73,1.44,1.68,3.14,2.6,4.78,2.11.09,4.2.13,6.24.12h.21l.12.18c1.06,1.66,2.18,3.31,3.31,4.91l.39.55c.39-1,.76-1.83,1.08-2.56,1.8-4.11,4.72-6.2,5.11-11.55C228.09,204,226.28,212.29,221.43,216.61Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M212,216c.86,1.49,1.78,3,2.72,4.47,1,0,2,0,2.92,0s1.78-.07,2.66-.13c-1-1.37-1.9-2.78-2.82-4.2C215.65,216.13,213.81,216.1,212,216Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M215.5,232.8c-1.32-1.82-2.62-3.73-3.86-5.69-1.65,0-3.3-.05-4.93-.13,1.14,2,2.36,4,3.64,5.94,1.18,0,2.37,0,3.53,0Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M220.79,221.08l-3.16.14-2.43.06c.88,1.34,1.67,2.51,2.41,3.61l.9,1.28,1.1-.1c.58-1.46,1.17-2.91,1.72-4.25Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M219,226.89l0,0h0l.17.25.12-.3Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M201.7,232.61l1,.07c-1.09-2-2.14-4-3.11-6l-.57,1c-.76,1.2-1.7,2.79-2.7,4.49C197.5,232.25,199.29,232.44,201.7,232.61Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M206.11,215.69c.74,1.48,1.66,3.24,2.47,4.72,1.68.07,3.46.11,5.21.11-1-1.52-1.88-3.05-2.75-4.56C208.89,215.86,207.27,215.77,206.11,215.69Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><path d="M208.34,211.4c-.53,1-1.21,2.2-2,3.53,1,.08,2.4.15,4.12.24-.75-1.33-1.49-2.66-2.11-3.86Z" transform="translate(-68.98 -174.01)" fill="#ffcd00"></path><line x1="152.03" y1="46.56" x2="153.36" y2="46.46" fill="none" stroke="#fff" stroke-miterlimit="3.86" stroke-width="0.77"></line><rect x="171.96" y="269.43" width="33.05" height="2.24" transform="translate(-206.29 147.32) rotate(-64)" fill="#ffcd00"></rect><path d="M176.42,295.05s26.77-33.2,68.67-52.07c0,0-23.14,3.68-59.39,33.06Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M176.43,295s9.71-41.52-1.22-86.15c0,0,11.35,20.49,10.5,67.15Z" transform="translate(-68.98 -174.01)" fill="#ffcd00" fill-rule="evenodd"></path><path d="M239,259.21v6.43h-2.86V249.73l4.66-.08a4.68,4.68,0,0,1,3.44,1.36,4.54,4.54,0,0,1,1.43,3.42A4.37,4.37,0,0,1,244,257.8a5.48,5.48,0,0,1-3.71,1.46Zm0-7.71v6h.8a2.82,2.82,0,0,0,2.11-.9,2.92,2.92,0,0,0,.9-2.11,2.68,2.68,0,0,0-2.72-3.05,2.17,2.17,0,0,0-.55,0Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M251.3,259.11h-.56v6.53h-2.86V249.73l2.54,0,2.23,0a4.58,4.58,0,0,1,3.45,1.24,4.5,4.5,0,0,1,1.19,3.37,4.86,4.86,0,0,1-1,3,4.34,4.34,0,0,1-2.2,1.53,55.78,55.78,0,0,0,5.67,6.48l-3.66.65A41.19,41.19,0,0,1,251.3,259.11Zm-.56-7.61v5.87h1c1.82,0,2.74-1.05,2.74-3.13a3.56,3.56,0,0,0-.41-1.77,2,2,0,0,0-2-1Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><rect x="191.85" y="75.72" width="2.93" height="15.91" fill="#0033a1"></rect><polygon points="210.94 81.03 207.16 91.65 204.58 91.65 200.78 80.93 200.78 91.63 198.16 91.63 198.16 75.69 201.92 75.69 206.26 87.41 210.67 75.69 214.19 75.69 214.19 91.63 210.94 91.63 210.94 81.03" fill="#0033a1" fill-rule="evenodd"></polygon><path d="M294.44,262H289.3l-1.14,4-2.57-.34,5.17-16.2h2.52l5.21,16.08-2.88.46Zm-4.46-2.3h3.78l-1.84-6.46Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M304.1,259.11h-.56v6.53h-2.86V249.73l2.54,0,2.23,0a4.58,4.58,0,0,1,3.45,1.24,4.5,4.5,0,0,1,1.19,3.37,4.86,4.86,0,0,1-1,3,4.32,4.32,0,0,1-2.21,1.53,56,56,0,0,0,5.68,6.48l-3.66.65A40.58,40.58,0,0,1,304.1,259.11Zm-.56-7.61v5.87h1c1.82,0,2.74-1.05,2.74-3.13a3.46,3.46,0,0,0-.42-1.77,2,2,0,0,0-2-1Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><polygon points="250.76 91.63 247.85 91.63 247.85 84.88 243.34 76.2 246.4 75.38 249.6 82.41 252.99 75.38 255.27 76.2 250.76 84.88 250.76 91.63" fill="#0033a1" fill-rule="evenodd"></polygon><path d="M340.74,262H335.6l-1.14,4-2.57-.34,5.17-16.2h2.52l5.21,16.08-2.88.46Zm-4.46-2.3h3.78l-1.84-6.46Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M346.17,257.46a9.17,9.17,0,0,1,1.7-5.55,6.25,6.25,0,0,1,5.31-2.67,9.63,9.63,0,0,1,4.88,1.72l-1,1.94a15.83,15.83,0,0,1-1.6-1,4.67,4.67,0,0,0-1.85-.43,3.48,3.48,0,0,0-3.13,2.25,8.67,8.67,0,0,0-.92,4,6.53,6.53,0,0,0,1.21,4,3.45,3.45,0,0,0,2.77,1.55,4.37,4.37,0,0,0,1.65-.32,12.54,12.54,0,0,0,1.91-1l1.17,1.94a18,18,0,0,1-2.57,1.46,7.14,7.14,0,0,1-2.62.46,6,6,0,0,1-5.24-2.62A9.82,9.82,0,0,1,346.17,257.46Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M368.66,262h-5.14l-1.14,4-2.58-.34,5.17-16.2h2.52l5.22,16.08-2.89.46Zm-4.47-2.3H368l-1.84-6.46Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M374.89,265.59V249.68c1.33-.07,2.67-.11,4-.12q7.56,0,7.64,8.05a8.28,8.28,0,0,1-1.92,5.89,7.47,7.47,0,0,1-5.82,2.18c-.4,0-1,0-1.77,0S375.57,265.59,374.89,265.59Zm4.24-14.09h-.58l-.65,0v12h1.38a3.57,3.57,0,0,0,3.1-1.82,6.7,6.7,0,0,0,1.07-3.81Q383.45,251.51,379.13,251.5Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><polygon points="322.79 81.92 328.44 81.92 328.44 84.13 322.79 84.11 322.79 89.42 328.76 89.42 328.76 91.63 319.93 91.63 319.93 75.74 328.83 75.74 328.83 77.85 322.79 77.85 322.79 81.92" fill="#0033a1" fill-rule="evenodd"></polygon><polygon points="344.43 81.03 340.64 91.65 338.07 91.65 334.26 80.93 334.26 91.63 331.65 91.63 331.65 75.69 335.4 75.69 339.75 87.41 344.16 75.69 347.68 75.69 347.68 91.63 344.43 91.63 344.43 81.03" fill="#0033a1" fill-rule="evenodd"></polygon><polygon points="357.21 91.63 354.3 91.63 354.3 84.88 349.79 76.2 352.84 75.38 356.05 82.41 359.44 75.38 361.72 76.2 357.21 84.88 357.21 91.63" fill="#0033a1" fill-rule="evenodd"></polygon><path d="M234.33,233.71l3.19-4.59q3.55,4.19,8.14,4.18,6.27,0,6.21-6.1,0-3.07-4.36-4.88a80.81,80.81,0,0,1-7.9-3.54q-4.29-3-4.24-9.12a9.91,9.91,0,0,1,3.9-8,11.06,11.06,0,0,1,7.08-2.61,17,17,0,0,1,11.21,4.24l-2.38,5q-4.06-3.82-7.67-3.83a5.49,5.49,0,0,0-3.6,1c-1,.77-1.43,2.19-1.39,4.24q0,2.73,4.18,4.41c4.34,1.74,6.93,3,7.78,3.6q4.25,3.14,4.19,9.35t-4,9.36a13.43,13.43,0,0,1-8.6,2.73Q238.21,239.17,234.33,233.71Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M277.54,239.57a13.69,13.69,0,0,1-9.46-3.48q-4.54-4.07-4.48-11.5V200.54h7v24.05a10.26,10.26,0,0,0,2.67,7.49,6.75,6.75,0,0,0,4.94,2.26,6.2,6.2,0,0,0,4.7-2.32,11,11,0,0,0,2.39-7.43V200.54h7.08v24.05q0,7.42-5,11.56A15.13,15.13,0,0,1,277.54,239.57Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><polygon points="246.9 64.57 239.81 64.57 239.81 31.41 229.01 31.41 229.01 26.59 257.12 26.59 257.12 31.41 246.9 31.41 246.9 64.57" fill="#0033a1" fill-rule="evenodd"></polygon><polygon points="278.73 64.57 271.64 64.57 271.64 31.41 260.84 31.41 260.84 26.59 288.95 26.59 288.95 31.41 278.73 31.41 278.73 64.57" fill="#0033a1" fill-rule="evenodd"></polygon><path d="M361.71,219.42a19.76,19.76,0,0,1,4.93-13.77,16.09,16.09,0,0,1,12.55-5.52,15.5,15.5,0,0,1,12.31,5.52q4.77,5.46,4.76,13.77,0,9.47-5.11,14.92a16.15,16.15,0,0,1-12.37,5.17,15.55,15.55,0,0,1-12.14-5.17Q361.71,228.9,361.71,219.42Zm7.43.52a18.06,18.06,0,0,0,2.73,10q2.73,4.24,6.91,4.24t7.2-4.36a16.88,16.88,0,0,0,2.85-9.75,19.36,19.36,0,0,0-2.61-10.23c-1.82-3-4.21-4.45-7.15-4.41s-5.36,1.47-7.26,4.41A18.6,18.6,0,0,0,369.14,219.94Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path><path d="M408,214.71l-.06,23.87h-6.1V200.31h5.69l15.34,24V200.54h6v37.17l-5.64,1.75Q417.47,228.77,408,214.71Z" transform="translate(-68.98 -174.01)" fill="#0033a1" fill-rule="evenodd"></path></svg>
                </div>
            </div>
        </div>

        <!-- Tutorial / Chat Window -->
        <div id="guide-container" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-900/50">
            <!-- Initial Welcome Message -->
            <div class="bg-blue-900/30 border-l-4 border-blue-500 p-3 text-sm rounded msg-enter">
                <p class="font-bold text-blue-300">Robot Guide:</p>
                <p>Welcome to the Workshop, Awesome Coder! Before we race, we need to build your bot.</p>
                <p class="mt-2">Step 1: Choose your chassis type!</p>
                
                <div class="flex gap-2 mt-3">
                    <button onclick="setCarType('racer')" class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded border border-slate-500 text-xs">üèéÔ∏è Speedster</button>
                    <button onclick="setCarType('tank')" class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded border border-slate-500 text-xs">üöú Crusher</button>
                    <button onclick="setCarType('ufo')" class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded border border-slate-500 text-xs">üõ∏ Saucer</button>
                </div>
            </div>
        </div>

        <!-- Console Input -->
        <div class="p-4 bg-slate-950 border-t border-slate-700">
            <div class="flex items-center text-green-400 text-lg">
                <span class="mr-2">></span>
                <input type="text" id="command-input" class="console-input" placeholder="Waiting for setup..." disabled autocomplete="off">
            </div>
            <div class="mt-2 text-xs text-slate-500 flex justify-between">
                <span>Cmds: f(n), b(n), r(deg), l(deg)</span>
                <span id="status-light" class="w-2 h-2 rounded-full bg-red-500"></span>
            </div>
        </div>
    </div>

    <!-- Main Stage: The Game -->
    <div class="relative flex-1 h-2/3 md:h-full bg-slate-800 overflow-hidden flex items-center justify-center">
        
        <!-- HUD -->
        <div class="absolute top-4 left-4 z-10 flex gap-4">
            <div class="bg-slate-900/80 p-2 rounded border border-slate-600 backdrop-blur">
                <div class="text-xs text-slate-400">DRIVER</div>
                <div id="driver-display" class="text-lg font-bold text-blue-400">UNKNOWN</div>
            </div>
            <div class="bg-slate-900/80 p-2 rounded border border-slate-600 backdrop-blur">
                <div class="text-xs text-slate-400">TIME</div>
                <div id="timer-display" class="text-xl font-mono text-yellow-400">00:00.00</div>
            </div>
        </div>

        <div class="absolute top-4 right-4 z-10 flex gap-2">
            <button onclick="executeCommand('reset')" id="btn-reset" class="hidden px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-slate-900 font-bold rounded shadow border border-yellow-400 flex items-center gap-2">
                <span>üèÅ Restart</span>
            </button>
            <button onclick="exportGame()" id="btn-export" class="hidden px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded shadow border border-purple-400 flex items-center gap-2">
                <span>üíæ Save Game</span>
            </button>
        </div>

        <!-- The Game Canvas -->
        <div class="CRT shadow-2xl border-4 border-slate-700 rounded-lg overflow-hidden bg-black">
            <canvas id="gameCanvas" width="800" height="600" class="block"></canvas>
        </div>

        <!-- Floating Feedback -->
        <div id="feedback-toast" class="absolute bottom-10 px-6 py-3 bg-slate-900/90 text-white rounded-full border border-green-500 shadow-[0_0_15px_rgba(74,222,128,0.3)] transform translate-y-20 opacity-0 transition-all duration-300 font-bold">
            Action Executed
        </div>
    </div>

    <script>
        // --- GAME CONFIG & STATE ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const input = document.getElementById('command-input');
        const guideContainer = document.getElementById('guide-container');
        const statusLight = document.getElementById('status-light');
        const timerDisplay = document.getElementById('timer-display');
        const driverDisplay = document.getElementById('driver-display');
        const btnReset = document.getElementById('btn-reset');
        
        let gameState = {
            initialized: false,
            playing: false,
            startTime: 0,
            elapsed: 0,
            laps: 0,
            checkpointsHit: [],
            tutorialStep: 0,
            commandsAllowed: false,
            finished: false
        };

        const car = {
            x: 100,
            y: 400,
            angle: -90, // Starts facing UP
            speed: 0,
            size: 20,
            color: '#3b82f6', // Default Blue
            type: 'racer', // racer, tank, ufo
            driverName: 'Guest'
        };

        const particles = [];
        const trackWidth = 80;
        
        // Track Logic
        const trackPath = [
            {x: 100, y: 500}, 
            {x: 100, y: 200}, 
            {x: 200, y: 100}, 
            {x: 600, y: 100}, 
            {x: 700, y: 200}, 
            {x: 700, y: 500}, 
            {x: 500, y: 500}, 
            {x: 500, y: 300}, 
            {x: 300, y: 300}, 
            {x: 300, y: 300}, 
            {x: 300, y: 500}, 
            {x: 100, y: 500}
        ];

        const checkpoints = [
            {x: 100, y: 350, r: 40, id: 1}, 
            {x: 400, y: 100, r: 40, id: 2}, 
            {x: 700, y: 350, r: 40, id: 3}, 
            {x: 400, y: 300, r: 40, id: 4}
        ];

        // --- WORKSHOP / SETUP FUNCTIONS ---

        let carChoiceMade = false;
        function setCarType(type) {
            car.type = type;
            draw(); // Redraw canvas to show new car immediately (even if engine not running)
            // Advance Guide
            if(!carChoiceMade) addMessage("Robot Guide", `Excellent choice! The ${type.toUpperCase()} is a solid build.`);
            carChoiceMade = true;
            showColorPicker();
        }
        
        function showColorPicker() {
            if(document.getElementById('color-picker')) return; // Prevent duplicates

            
            const div = document.createElement('div');
            div.id = "color-picker";
            div.className = "bg-blue-900/30 border-l-4 border-pink-500 p-3 text-sm rounded msg-enter mt-2";
            div.innerHTML = `
                <p class="font-bold text-pink-300">Robot Guide:</p>
                <p>Step 2: Mix your custom paint color!</p>
                <div class="space-y-2 mt-2">
                    <div class="flex items-center gap-2"><span class="w-4 text-red-400">R</span><input type="range" min="0" max="255" value="59" class="w-full h-2 bg-red-900 rounded-lg appearance-none cursor-pointer" oninput="updateCarColor(this.value, null, null)"></div>
                    <div class="flex items-center gap-2"><span class="w-4 text-green-400">G</span><input type="range" min="0" max="255" value="130" class="w-full h-2 bg-green-900 rounded-lg appearance-none cursor-pointer" oninput="updateCarColor(null, this.value, null)"></div>
                    <div class="flex items-center gap-2"><span class="w-4 text-blue-400">B</span><input type="range" min="0" max="255" value="246" class="w-full h-2 bg-blue-900 rounded-lg appearance-none cursor-pointer" oninput="updateCarColor(null, null, this.value)"></div>
                </div>
                <button onclick="confirmColor()" class="mt-3 w-full py-1 bg-pink-600 hover:bg-pink-500 rounded font-bold">Confirm Paint</button>
            `;
            guideContainer.appendChild(div);
            guideContainer.scrollTop = guideContainer.scrollHeight;
        }

        let tempColor = {r:59, g:130, b:246};
        function updateCarColor(r, g, b) {
            if(r !== null) tempColor.r = r;
            if(g !== null) tempColor.g = g;
            if(b !== null) tempColor.b = b;
            car.color = `rgb(${tempColor.r}, ${tempColor.g}, ${tempColor.b})`;
            draw(); // Live preview
        }

        let colorConfirmed = false;
        function confirmColor() {

            if(!colorConfirmed) addMessage("Robot Guide", "Looking stylish!");
            colorConfirmed = true;
            
            showNameInput();
        }

        function showNameInput() {
            if(document.getElementById('name-input')) return; // Prevent duplicates

            const div = document.createElement('div');
            div.id = "name-input";
            div.className = "bg-blue-900/30 border-l-4 border-yellow-500 p-3 text-sm rounded msg-enter mt-2";
            div.innerHTML = `
                <p class="font-bold text-yellow-300">Robot Guide:</p>
                <p>Step 3: What is your Driver Name?</p>
                <div class="flex gap-2 mt-2">
                    <input type="text" id="driver-input" class="bg-slate-800 border border-slate-600 rounded px-2 py-1 w-full text-white" placeholder="Enter Name">
                    <button onclick="confirmName()" class="px-4 bg-yellow-600 hover:bg-yellow-500 rounded font-bold">OK</button>
                </div>
            `;
            guideContainer.appendChild(div);
            guideContainer.scrollTop = guideContainer.scrollHeight;
        }

        function confirmName() {
            const nameVal = document.getElementById('driver-input').value || "Racer X";
            car.driverName = nameVal;
            driverDisplay.textContent = nameVal.toUpperCase();
            
            // Show Init Button
            const div = document.createElement('div');
            div.className = "bg-blue-900/30 border-l-4 border-green-500 p-3 text-sm rounded msg-enter mt-2";
            div.innerHTML = `
                <p class="font-bold text-green-300">Robot Guide:</p>
                <p>Setup Complete! Systems Green.</p>
                <button onclick="startEngine()" class="mt-3 w-full py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded shadow transition-all">
                    Start Engine!
                </button>
            `;
            guideContainer.appendChild(div);
            guideContainer.scrollTop = guideContainer.scrollHeight;
        }

        function startEngine() {
            // Disable setup buttons if any exist
            document.querySelectorAll('button').forEach(b => {
                if(b.textContent !== 'Start Engine!' && !b.id) b.disabled = true;
            });
            
            gameState.initialized = true;
            initGame();

            addMessage("Robot Guide", "Vroooom! Engine Online.");
            addMessage("Robot Guide", "TUTORIAL: Type 'f 75' (forward 75) below to move up the track!");
            
            input.disabled = false;
            input.placeholder = "Enter command...";
            input.focus();
            gameState.commandsAllowed = true;
            statusLight.classList.replace('bg-red-500', 'bg-green-500');
            gameState.tutorialStep = 2; // Jumping into the move tutorial
        }


        // --- CORE GAME ENGINE ---

        function initGame() {
            requestAnimationFrame(gameLoop);
            resetCar();
        }

        function resetCar() {
            car.x = 100;
            car.y = 400;
            car.angle = -90; 
            car.speed = 0;
            gameState.laps = 0;
            gameState.checkpointsHit = [];
            gameState.elapsed = 0;
            gameState.startTime = 0;
            gameState.finished = false;
            gameState.playing = false;
            btnReset.classList.add('hidden');
            updateHUD();
        }

        function updateHUD() {
            const mins = Math.floor(gameState.elapsed / 60000).toString().padStart(2, '0');
            const secs = Math.floor((gameState.elapsed % 60000) / 1000).toString().padStart(2, '0');
            const ms = Math.floor((gameState.elapsed % 1000) / 10).toString().padStart(2, '0');
            timerDisplay.textContent = `${mins}:${secs}.${ms}`;
        }

        function checkOnTrack(x, y) {
            const path = new Path2D();
            path.moveTo(trackPath[0].x, trackPath[0].y);
            for (let i = 1; i < trackPath.length; i++) {
                path.lineTo(trackPath[i].x, trackPath[i].y);
            }
            path.closePath();

            ctx.save();
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = trackWidth;
            const isSafe = ctx.isPointInStroke(path, x, y);
            ctx.restore();
            return isSafe;
        }

        function gameLoop() {
            updatePhysics();
            draw();
            if (gameState.playing) gameState.elapsed = Date.now() - gameState.startTime;
            updateHUD();
            requestAnimationFrame(gameLoop);
        }

        function updatePhysics() {
            if (car.speed !== 0) {
                const rad = car.angle * Math.PI / 180;
                car.x += Math.cos(rad) * car.speed;
                car.y += Math.sin(rad) * car.speed;
                
                if(Math.random() > 0.5) {
                    particles.push({
                        x: car.x - Math.cos(rad) * 15,
                        y: car.y - Math.sin(rad) * 15,
                        vx: (Math.random() - 0.5),
                        vy: (Math.random() - 0.5),
                        life: 1.0
                    });
                }
            }

            for(let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].vx;
                particles[i].y += particles[i].vy;
                particles[i].life -= 0.05;
                if(particles[i].life <= 0) particles.splice(i, 1);
            }

            checkpoints.forEach(cp => {
                const dist = Math.hypot(car.x - cp.x, car.y - cp.y);
                if (dist < cp.r && !gameState.checkpointsHit.includes(cp.id)) {
                    gameState.checkpointsHit.push(cp.id);
                    showFeedback("Checkpoint!", "blue");
                }
            });

            if (gameState.checkpointsHit.length === 4) {
                const distToStart = Math.hypot(car.x - 100, car.y - 400);
                if (distToStart < 40 && gameState.playing) finishRace();
            }
        }

        function draw() {
            // Background
            ctx.fillStyle = '#334155';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Track
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Grass Border
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = trackWidth + 20;
            drawPath(ctx, trackPath, true);

            // Asphalt
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = trackWidth;
            drawPath(ctx, trackPath, true);
            
            // Center Lines
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 15]);
            drawPath(ctx, trackPath, true);
            ctx.setLineDash([]);

            // Checkpoints
            checkpoints.forEach(cp => {
                ctx.beginPath();
                ctx.arc(cp.x, cp.y, 10, 0, Math.PI * 2);
                ctx.fillStyle = gameState.checkpointsHit.includes(cp.id) ? '#4ade80' : '#ef4444';
                ctx.fill();
            });

            // Start Line
            ctx.save();
            ctx.translate(100, 400);
            ctx.fillStyle = '#ffffff';
            for(let i=0; i<4; i++) {
                ctx.fillRect(-40 + (i*20), -5, 10, 10);
                ctx.fillStyle = ctx.fillStyle === '#000000' ? '#ffffff' : '#000000';
            }
            ctx.restore();

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = '#cbd5e1';
                ctx.fillRect(p.x, p.y, 3, 3);
            });
            ctx.globalAlpha = 1;

            // DRAW CAR (Based on Type)
            ctx.save();
            ctx.translate(car.x, car.y);
            ctx.rotate(car.angle * Math.PI / 180);
            
            // Draw Car Shadow
            ctx.shadowBlur = 10;
            ctx.shadowColor = car.color;

            if (car.type === 'tank') {
                // TANK DRAWING
                ctx.fillStyle = '#333';
                ctx.fillRect(-18, -15, 36, 6); // Left Tread
                ctx.fillRect(-18, 9, 36, 6);   // Right Tread
                ctx.fillStyle = car.color;
                ctx.fillRect(-12, -10, 24, 20); // Body
                ctx.fillStyle = '#111';
                ctx.fillRect(0, -3, 20, 6); // Turret/Barrel
            } 
            else if (car.type === 'ufo') {
                // UFO DRAWING
                ctx.fillStyle = car.color;
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2); // Main Disc
                ctx.fill();
                ctx.fillStyle = '#bef264';
                ctx.beginPath();
                ctx.arc(0, 0, 6, 0, Math.PI * 2); // Cockpit
                ctx.fill();
                // Little lights
                ctx.fillStyle = 'white';
                for(let i=0; i<4; i++) ctx.fillRect(10, -10+(i*5), 2, 2); 
            } 
            else {
                // RACER DRAWING (Default)
                ctx.fillStyle = car.color;
                ctx.fillRect(-15, -10, 30, 20); // Body
                ctx.fillStyle = '#93c5fd';
                ctx.fillRect(0, -8, 8, 16); // Windshield
                ctx.fillStyle = 'black'; // Wheels
                ctx.fillRect(-12, -12, 8, 4); ctx.fillRect(-12, 8, 8, 4);
                ctx.fillRect(8, -12, 8, 4); ctx.fillRect(8, 8, 8, 4);
            }

            // Headlights (Common)
            if (car.type !== 'ufo') {
                ctx.fillStyle = '#fef08a';
                ctx.globalAlpha = 0.6;
                ctx.beginPath(); ctx.arc(15, -5, 5, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.arc(15, 5, 5, 0, Math.PI * 2); ctx.fill();
            }

            ctx.restore();
        }

        function drawPath(context, points, close) {
            context.beginPath();
            context.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                context.lineTo(points[i].x, points[i].y);
            }
            if (close) context.closePath();
            context.stroke();
        }

        function finishRace() {
            gameState.playing = false;
            gameState.finished = true;
            showFeedback(`Time: ${timerDisplay.textContent}`, "purple");
            btnReset.classList.remove('hidden');

            if(gameState.tutorialStep < 4) {
                 addMessage("Robot Guide", `AMAZING! You finished in ${timerDisplay.textContent}. Save your game or Restart to try again!`);
                 document.getElementById('btn-export').classList.remove('hidden');
                 gameState.tutorialStep = 5;
            } else {
                 addMessage("Robot Guide", `Race Complete! Hit Restart to go again.`);
            }
        }

        // --- COMMANDS ---

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const cmd = input.value.trim().toLowerCase();
                input.value = '';
                executeCommand(cmd);
            }
        });

        async function executeCommand(cmdStr) {
            if (!gameState.commandsAllowed) return;

            if (!gameState.playing && !gameState.finished && cmdStr !== 'reset') {
                gameState.playing = true;
                gameState.startTime = Date.now();
            }

            const savedState = { ...car };
            addMessage(car.driverName, cmdStr); // Use Custom Name

            const parts = cmdStr.split(' ');
            const action = parts[0];
            const value = parseInt(parts[1]);

            if (cmdStr === 'reset') {
                resetCar();
                addMessage("Robot Guide", "Back to start!");
                return;
            }

            if (isNaN(value) && ['f','forward','fd','b','backward','bk','l','left','lt','r','right','rt'].includes(action)) {
                addMessage("Error", "Need a number! Try 'f 50'.");
                return;
            }

            // Execute Animation
            if (['f','forward','fd'].includes(action)) await animateMove(value);
            else if (['b','backward','bk'].includes(action)) await animateMove(-value);
            else if (['l','left','lt'].includes(action)) await animateTurn(-value);
            else if (['r','right','rt'].includes(action)) await animateTurn(value);
            else {
                addMessage("Error", "Unknown command.");
                return;
            }

            // Crash Check
            if (!checkOnTrack(car.x, car.y)) {
                showFeedback("CRASH!", "red");
                addMessage("Error", "Off track! Undoing.");
                await new Promise(r => setTimeout(r, 600));
                // Revert
                Object.assign(car, savedState);
            }
            
            // Tutorial Checks
            if(gameState.tutorialStep === 2 && ['f','fd','forward'].includes(action)) {
                gameState.tutorialStep = 3;
                setTimeout(() => addMessage("Robot Guide", "Good! Now turn right at the corner (try 'r 45')."), 500);
            }
            else if(gameState.tutorialStep === 3 && ['r','rt','right'].includes(action)) {
                gameState.tutorialStep = 4;
                setTimeout(() => addMessage("Robot Guide", "Perfect! Now finish the lap!"), 500);
            }
        }

        function animateMove(dist) {
            dist *= 5.5;
            return new Promise(resolve => {
                const steps = Math.abs(dist);
                const dir = dist > 0 ? 1 : -1;
                let moved = 0;
                const interval = setInterval(() => {
                    if (moved >= steps) {
                        car.speed = 0; clearInterval(interval); resolve();
                    } else {
                        car.speed = dir * 4; moved += 4;
                    }
                }, 8);
            });
        }

        function animateTurn(deg) {
            return new Promise(resolve => {
                const steps = Math.abs(deg);
                const dir = deg > 0 ? 1 : -1;
                let turned = 0;
                const interval = setInterval(() => {
                    if (turned >= steps) {
                        clearInterval(interval); resolve();
                    } else {
                        car.angle += dir; 
                        turned++;
                    }
                }, 4);
            });
        }

        function addMessage(sender, text) {
            const div = document.createElement('div');
            const isGuide = sender === 'Robot Guide';
            const isError = sender === 'Error';
            const color = isGuide ? 'text-blue-300' : (isError ? 'text-red-400' : 'text-green-300');
            const bg = isGuide ? 'bg-blue-900/20' : 'bg-transparent';
            
            div.className = `p-2 text-sm rounded msg-enter ${bg} border-l-2 border-slate-700 mb-2`;
            div.innerHTML = `<span class="${color} font-bold">${sender}:</span> ${text}`;
            guideContainer.appendChild(div);
            guideContainer.scrollTop = guideContainer.scrollHeight;
        }

        function showFeedback(text, color) {
            const toast = document.getElementById('feedback-toast');
            toast.textContent = text;
            toast.style.borderColor = color === "purple" ? "#a855f7" : (color === "red" ? "#ef4444" : "#4ade80");
            toast.classList.remove('opacity-0', 'translate-y-20');
            setTimeout(() => toast.classList.add('opacity-0', 'translate-y-20'), 2000);
        }

        function exportGame() {
            let htmlContent = document.documentElement.outerHTML;
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, 'text/html');

            // Reset UI for saved game
            doc.getElementById('guide-container').innerHTML = `
                <div class="bg-purple-900/30 border-l-4 border-purple-500 p-3 text-sm rounded">
                    <p class="font-bold text-purple-300">Robot Guide:</p>
                    <p>Game Loaded. Driver: ${car.driverName}</p>
                </div>
            `;
            doc.getElementById('btn-export').remove();
            doc.getElementById('btn-reset').remove();
            
            // Embed current car state into the init script
            const script = doc.createElement('script');
            script.textContent = `
                window.onload = function() {
                    gameState.initialized = true;
                    gameState.commandsAllowed = true;
                    car.type = '${car.type}';
                    car.color = '${car.color}';
                    car.driverName = '${car.driverName}';
                    document.getElementById('driver-display').textContent = '${car.driverName.toUpperCase()}';
                    document.getElementById('status-light').classList.replace('bg-red-500', 'bg-green-500');
                    initGame();
                };
            `;
            doc.body.appendChild(script);

            const blob = new Blob([doc.documentElement.outerHTML], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sutton-racer-custom.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            addMessage("Robot Guide", "Game Saved!");
        }
        
        // Start Render Loop immediately for vehicle preview
        requestAnimationFrame(draw);

    </script>
</body>
</html>
